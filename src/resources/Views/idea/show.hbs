<div class="container">
    <div class="title-of-idea container-fluid">
        <div class="row">
            <div class="col-0.5">
             <span class="avatar-for-idea"><img class="profile-img-idea" src="{{userLogin.avatar}}" alt="avatar"></span>
            </div>
            <div class="col-11.5">
             <b style="margin-bottom:0; padding-left:5px;">{{idea.username.username}}</b>
             <p style="font-size: 10px; color:rgb(107, 104, 104); padding-left:5px;">{{moment idea.createdAt format="DD-MM-YYYY on HH:mm"}}</p>
            </div>
        </div>
            <p style="font-size:18px">{{idea.title}}</p>
            <p style="font-size:14px">{{idea.detail}}</p>
            <p>File: <a id="file-check" href="../../idea/{{idea.file}}">{{idea.file}}</a></p>
                <p><i class="fas fa-heart" style="color:red"></i> <span id="ratings-{{ idea._id }}">{{ idea.ratings }}</span></p>
                <hr>
                <div class="interactive-for-idea">
                <div class="like-unlike-btn">
                    <button onclick="actOnPost(event);" class="btn btn-success btn-reactive"
                            data-post-id="{{ idea._id }}">Like</button>
                    <button onclick="actOnPost(event);" class="btn btn-success btn-reactive"
                            data-post-id="{{ idea._id }}">Unlike
                    </button>
                </div>
                <div id="show-content-idea" class="show-content-of-idea">
                    <p>Show content</p>
                </div>
            </div>
                <div id="commentIdea" class="comment-for-idea">
                   <hr>
                    {{#idea}}
                    {{#comment}}
                        {{#if annoymous}}
                        <input id="comment-posted-username" value="Anonymous" class="mt-4" disabled style="display: none;">
                        <img class="profile-img-for-comment" src="https://www.w3schools.com/howto/img_avatar.png" alt="avatar">
                            <div class="box-comment">
                            <p><b>Anonymous</b><br>{{content}}</p>
                            </div>
                        <div style="margin-left: 32px;"><p style="font-size: 10px; color:rgb(107, 104, 104);">{{moment commentAt format="DD-MM-YYYY on HH:mm"}}</p></div>
                        {{else}}
                        <input id="comment-posted-username" value="Name: {{userName}}" class="mt-4" disabled style="display: none;">
                        <img class="profile-img-for-comment" src="https://www.w3schools.com/howto/img_avatar.png" alt="avatar">
                            <div class="box-comment">
                            <p><b>{{userName}}</b><br>{{content}}</p>
                            </div>
                        <div style="margin-left: 32px;"><p style="font-size: 10px; color:rgb(107, 104, 104);">{{moment commentAt format="DD-MM-YYYY on HH:mm"}}</p></div>
                        {{/if}}
                    {{/comment}}
                    {{/idea}}
                    <hr>
                    <form action="/idea/{{idea._id}}/storeComment?_method=PUT" method="post"> 
                        <input class="form-control" type="text" style="" id="comment-user-name" name="userName" hidden>
                        <span><img class="profile-img-input-comment" src="{{userLogin.avatar}}" alt="avatar"></span>
                        <input class=" input-comment" placeholder="Write comment..." type="text" name="content">
                        <p style="font-size: 12px; margin-left:35px">
                            <input type="checkbox" style="widh:10px; height:10px" id="comment-annoymous" value="true" name="annoymous">
                            Comment as anonymous
                        </p>
                        {{!-- ====================== For send email comment HIDDEN form ====================================--}}

                        <input type="" id="comment-idea-id input-comment" name="idea_id" value="{{idea._id}}" hidden>
                        <input class="form-control input-comment" id="comment-date" name="commentAt"hidden>
                        <input type="text" name="ideaTitle" value="{{idea.title}}"hidden>
                        <input type="text" name="emailReceiver" value="{{idea.username.email}}" hidden>
                        {{!-- ============================================================================ --}}
                        <input class="input-comment btn btn-success" type="submit" value="Submit" hidden>
                    </form> 
                </div>
    </div>
</div>

<script>
    var showContent= document.getElementById('show-content-idea')
    var commentIdea=document.getElementById('commentIdea')
    showContent.onclick=function(){
        commentIdea.setAttribute("style", "display:block")
    }
</script>


{{!-- Auto import username and comment date for user comment --}}
<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
    <script>
        $(document).ready(function () {
            //Assign the user name of who is using to input form
            $('input[id="comment-user-name"]').val("{{userLogin.username}}");
            //Assign time now for posting cmt
            $('input[id="comment-date"]').val(Date.now());
            //Deadline comment for users
            var btnReactive = $('.btn-reactive')
            var inputCmt = $('.input-comment')
            var deadlineSubmitDate = new Date("{{idea.categoryName.deadlineCmt}}")
            if ( deadlineSubmitDate <= Date.now()){
                btnReactive.attr("disabled","disabled")
                inputCmt.attr("disabled","disabled")
            }
        });

    </script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script>

        //Check type of file uploaded to import icon 
        var imgShow = '<img src="/idea/{{this.file}}" alt="{{this.title}}" style="width:50px; height:50px">'
        var pdfShow = '<i class="fa fa-file-powerpoint"></i> {{this.file}}'
        var wordShow = '<i class="fa fa-file-word"></i> {{idea.file}}'
        var excelShow = '<i class="fa fa-file-xls"></i> {{this.file}}'
        var fileCheck = document.getElementById("file-check").innerHTML
        var fileName;
        var fileLastName;
        fileName = fileCheck.split('.')
        fileLastName = fileName[fileName.length -1]

        if (fileLastName == 'doc' || fileLastName == 'docx' || fileLastName == 'txt'){
            document.getElementById("file-check").innerHTML = wordShow;
        }
        else if (fileLastName == 'xls'){
            document.getElementById("file-check").innerHTML = excelShow;
        }
        else if (fileLastName == 'jpg' || fileLastName=='jpeg' || fileLastName== 'png' ){
            document.getElementById("file-check").innerHTML = imgShow;
        }
        else if (fileLastName == 'pdf') {
            document.getElementById("file-check").innerHTML = pdfShow
        }
        else{
            document.getElementById("file-check").innerHTML = ''
        }

        //Like button
        var updateIdeaRatings = {
            Like: function (postId) {
                document.querySelector('#ratings-' + postId).textContent++;
            },
            Unlike: function(postId) {
                document.querySelector('#ratings-' + postId).textContent--;
            }
        };
    
        var toggleButtonText = {
            Like: function(button) {
                button.textContent = "Unlike";
            },
            Unlike: function(button) {
                button.textContent = "Like";
            }
        };
    
        var actOnPost = function (event) {
            var postId = event.target.dataset.postId;
            var action = event.target.textContent.trim();
            toggleButtonText[action](event.target);
            updateIdeaRatings[action](postId);
            axios.post('/idea/' + postId + '/interactive?_method=PUT', { action: action });
        };
    </script>